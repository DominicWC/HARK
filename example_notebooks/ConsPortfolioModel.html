
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Portfolio Models in HARK &#8212; HARK latest documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'example_notebooks/ConsPortfolioModel';</script>
    <link rel="canonical" href="https://docs.econ-ark.org/example_notebooks/ConsPortfolioModel.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Permanent versus Persistent Income Shocks" href="GenIncProcessModel.html" />
    <link rel="prev" title="KinkedRconsumerType: Consumption-saving model with idiosyncratic income shocks and different interest rates on borrowing and saving" href="KinkedRconsumerType.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    <p class="title logo__title">HARK latest documentation</p>
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../introduction.html">
                        Introduction
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../quick-start.html">
                        Installing HARK
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../ARKitecture.html">
                        ARKitecture of Econ-ARK
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../contributing/CONTRIBUTING.html">
                        Contributing to Econ-ARK
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../reference/index.html">
                        API Documentation
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../CHANGELOG.html">
                        Release Notes
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../license.html">
                        License
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="Gentle-Intro-To-HARK.html">
                        A Gentle Introduction to HARK
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="PerfForesightConsumerType.html">
                        PerfForesightConsumerType: Perfect foresight consumption-saving
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="IndShockConsumerType.html">
                        IndShockConsumerType Documentation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="KinkedRconsumerType.html">
                        KinkedRconsumerType: Consumption-saving model with idiosyncratic income shocks and different interest rates on borrowing and saving
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                        Portfolio Models in HARK
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="GenIncProcessModel.html">
                        Permanent versus Persistent Income Shocks
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="LifecycleModel.html">
                        A Lifecycle Model: The Distribution of Assets By Age
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="HowWeSolveIndShockConsumerType.html">
                        How we solve a model defined by the IndShockConsumerType class
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../introduction.html">
                        Introduction
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../quick-start.html">
                        Installing HARK
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../ARKitecture.html">
                        ARKitecture of Econ-ARK
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../contributing/CONTRIBUTING.html">
                        Contributing to Econ-ARK
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../reference/index.html">
                        API Documentation
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../CHANGELOG.html">
                        Release Notes
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../license.html">
                        License
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="Gentle-Intro-To-HARK.html">
                        A Gentle Introduction to HARK
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="PerfForesightConsumerType.html">
                        PerfForesightConsumerType: Perfect foresight consumption-saving
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="IndShockConsumerType.html">
                        IndShockConsumerType Documentation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="KinkedRconsumerType.html">
                        KinkedRconsumerType: Consumption-saving model with idiosyncratic income shocks and different interest rates on borrowing and saving
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                        Portfolio Models in HARK
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="GenIncProcessModel.html">
                        Permanent versus Persistent Income Shocks
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="LifecycleModel.html">
                        A Lifecycle Model: The Distribution of Assets By Age
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="HowWeSolveIndShockConsumerType.html">
                        How we solve a model defined by the IndShockConsumerType class
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Portfolio Models in HARK</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="Portfolio-Models-in-HARK">
<h1>Portfolio Models in HARK<a class="headerlink" href="#Portfolio-Models-in-HARK" title="Permalink to this heading">#</a></h1>
<p>In this notebook, we consider the solution and simulation of a number of microeconomic problems in the context of optimal portfolio choice.</p>
<p>The agents in this model are first defined using the dictionary from the <code class="docutils literal notranslate"><span class="pre">PerfForesightConsumerType</span></code> class and additional attributes are added using the <code class="docutils literal notranslate"><span class="pre">IndShockConsumerType</span></code> class.</p>
<p>From there, the <code class="docutils literal notranslate"><span class="pre">ConsPortfolioDict</span></code> dictionary is introduced to create the <code class="docutils literal notranslate"><span class="pre">PortfolioConsumerType</span></code> and each of the subseqeunt agent types using it.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span><span class="p">,</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">HARK.ConsumptionSaving.ConsIndShockModel</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">init_lifecycle</span><span class="p">,</span>
    <span class="n">time_params</span><span class="p">,</span>
    <span class="n">dist_params</span><span class="p">,</span>
    <span class="n">income_params</span><span class="p">,</span>
    <span class="n">liv_prb</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">HARK.ConsumptionSaving.ConsPortfolioModel</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">PortfolioConsumerType</span><span class="p">,</span>
    <span class="n">init_portfolio</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">HARK.utilities</span> <span class="kn">import</span> <span class="n">plot_funcs</span>
</pre></div>
</div>
</div>
<section id="1.-The-baseline-model-of-optimal-portfolio-choice">
<h2>1. The baseline model of optimal portfolio choice<a class="headerlink" href="#1.-The-baseline-model-of-optimal-portfolio-choice" title="Permalink to this heading">#</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initial attempt for defining a dictionary for the Portfolio consumer type -- needs to be tested!</span>

<span class="n">ConsPortfolioDict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># Parameters shared with the Perfect foresight consumer type</span>
    <span class="s2">&quot;CRRA&quot;</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">,</span>  <span class="c1"># Coefficient of relative risk aversion,</span>
    <span class="s2">&quot;Rfree&quot;</span><span class="p">:</span> <span class="mf">1.03</span><span class="p">,</span>  <span class="c1"># Interest factor on assets</span>
    <span class="s2">&quot;DiscFac&quot;</span><span class="p">:</span> <span class="mf">0.90</span><span class="p">,</span>  <span class="c1"># Intertemporal discount factor</span>
    <span class="s2">&quot;LivPrb&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.98</span><span class="p">],</span>  <span class="c1"># Survival probability</span>
    <span class="s2">&quot;PermGroFac&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.01</span><span class="p">],</span>  <span class="c1"># Permanent income growth factor</span>
    <span class="s2">&quot;BoroCnstArt&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Artificial borrowing constraint</span>
    <span class="s2">&quot;MaxKinks&quot;</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span>  <span class="c1"># Maximum number of grid points to allow in cFunc (should be large)</span>
    <span class="s2">&quot;AgentCount&quot;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>  <span class="c1"># Number of agents of this type (only matters for simulation)</span>
    <span class="s2">&quot;aNrmInitMean&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Mean of log initial assets (only matters for simulation)</span>
    <span class="s2">&quot;aNrmInitStd&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># Standard deviation of log initial assets (only for simulation)</span>
    <span class="s2">&quot;pLvlInitMean&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Mean of log initial permanent income (only matters for simulation)</span>
    <span class="s2">&quot;pLvlInitStd&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Standard deviation of log initial permanent income (only matters for simulation)</span>
    <span class="s2">&quot;PermGroFacAgg&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># Aggregate permanent income growth factor: portion of PermGroFac attributable to aggregate productivity growth (only matters for simulation)</span>
    <span class="s2">&quot;T_age&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Age after which simulated agents are automatically killed</span>
    <span class="s2">&quot;T_cycle&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Number of periods in the cycle for this agent type</span>
    <span class="s2">&quot;PerfMITShk&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># Do Perfect Foresight MIT Shock: Forces Newborns to follow solution path of the agent he/she replaced when True</span>
    <span class="c1"># assets above grid parameters</span>
    <span class="s2">&quot;aXtraMin&quot;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span>  <span class="c1"># Minimum end-of-period &quot;assets above minimum&quot; value</span>
    <span class="s2">&quot;aXtraMax&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>  <span class="c1"># Maximum end-of-period &quot;assets above minimum&quot; value</span>
    <span class="s2">&quot;aXtraNestFac&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Exponential nesting factor when constructing &quot;assets above minimum&quot; grid</span>
    <span class="s2">&quot;aXtraCount&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>  <span class="c1"># Number of points in the grid of &quot;assets above minimum&quot;</span>
    <span class="s2">&quot;aXtraExtra&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="kc">None</span>
    <span class="p">],</span>  <span class="c1"># Some other value of &quot;assets above minimum&quot; to add to the grid, not used</span>
    <span class="c1"># Income process variables</span>
    <span class="s2">&quot;PermShkStd&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">],</span>  <span class="c1"># Standard deviation of log permanent income shocks</span>
    <span class="s2">&quot;PermShkCount&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>  <span class="c1"># Number of points in discrete approximation to permanent income shocks</span>
    <span class="s2">&quot;TranShkStd&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">],</span>  <span class="c1"># Standard deviation of log transitory income shocks</span>
    <span class="s2">&quot;TranShkCount&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>  <span class="c1"># Number of points in discrete approximation to transitory income shocks</span>
    <span class="s2">&quot;UnempPrb&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>  <span class="c1"># Probability of unemployment while working</span>
    <span class="s2">&quot;UnempPrbRet&quot;</span><span class="p">:</span> <span class="mf">0.005</span><span class="p">,</span>  <span class="c1"># Probability of &quot;unemployment&quot; while retired</span>
    <span class="s2">&quot;IncUnemp&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>  <span class="c1"># Unemployment benefits replacement rate</span>
    <span class="s2">&quot;IncUnempRet&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># &quot;Unemployment&quot; benefits when retired</span>
    <span class="s2">&quot;tax_rate&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Flat income tax rate</span>
    <span class="s2">&quot;T_retire&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># Period of retirement (0 --&gt; no retirement)</span>
    <span class="s2">&quot;vFuncBool&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># Whether to calculate the value function during solution</span>
    <span class="s2">&quot;CubicBool&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># Use cubic spline interpolation when True, linear interpolation when False</span>
    <span class="s2">&quot;neutral_measure&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># Use permanent income neutral measure (see Harmenberg 2021) during simulations when True.</span>
    <span class="s2">&quot;NewbornTransShk&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># Whether Newborns have transitory shock. The default is False.</span>
    <span class="c1"># Attributes specific to the Portfolio consumer</span>
    <span class="s2">&quot;RiskyAvg&quot;</span><span class="p">:</span> <span class="mf">1.08</span><span class="p">,</span>  <span class="c1"># Average return of the risky asset</span>
    <span class="s2">&quot;RiskyStd&quot;</span><span class="p">:</span> <span class="mf">0.20</span><span class="p">,</span>  <span class="c1"># Standard deviation of (log) risky returns</span>
    <span class="s2">&quot;RiskyCount&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>  <span class="c1"># Number of integration nodes to use in approximation of risky returns</span>
    <span class="s2">&quot;ShareCount&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>  <span class="c1"># Number of discrete points in the risky share approximation</span>
    <span class="s2">&quot;AdjustPrb&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># Probability that the agent can adjust their risky portfolio share each period</span>
    <span class="s2">&quot;DiscreteShareBool&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># Flag for whether to optimize risky share on a discrete grid only</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make and solve an example portfolio choice consumer type</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Now solving an example portfolio choice problem; this might take a moment...&quot;</span><span class="p">)</span>
<span class="n">MyType</span> <span class="o">=</span> <span class="n">PortfolioConsumerType</span><span class="p">(</span><span class="o">**</span><span class="n">ConsPortfolioDict</span><span class="p">)</span>
<span class="n">MyType</span><span class="o">.</span><span class="n">cycles</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">MyType</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">MyType</span><span class="o">.</span><span class="n">cFunc</span> <span class="o">=</span> <span class="p">[</span><span class="n">MyType</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">cFuncAdj</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MyType</span><span class="o">.</span><span class="n">T_cycle</span><span class="p">)]</span>
<span class="n">MyType</span><span class="o">.</span><span class="n">ShareFunc</span> <span class="o">=</span> <span class="p">[</span><span class="n">MyType</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">ShareFuncAdj</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MyType</span><span class="o">.</span><span class="n">T_cycle</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Solving an infinite horizon portfolio choice problem took &quot;</span>
    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>
    <span class="o">+</span> <span class="s2">&quot; seconds.&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Now solving an example portfolio choice problem; this might take a moment...
Solving an infinite horizon portfolio choice problem took 5.533383846282959 seconds.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the consumption and risky-share functions</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Consumption function over market resources:&quot;</span><span class="p">)</span>
<span class="n">plot_funcs</span><span class="p">(</span><span class="n">MyType</span><span class="o">.</span><span class="n">cFunc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Risky asset share as a function of market resources:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Optimal (blue) versus Theoretical Limit (orange)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Normalized Market Resources&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Portfolio Share&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="c1"># Since we are using a discretization of the lognormal distribution,</span>
<span class="c1"># the limit is numerically computed and slightly different from</span>
<span class="c1"># the analytical limit obtained by Merton and Samuelson for infinite wealth</span>
<span class="n">plot_funcs</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">MyType</span><span class="o">.</span><span class="n">ShareFunc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">MyType</span><span class="o">.</span><span class="n">ShareLimit</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">m</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">200.0</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Consumption function over market resources:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_ConsPortfolioModel_5_1.png" src="../_images/example_notebooks_ConsPortfolioModel_5_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Risky asset share as a function of market resources:
Optimal (blue) versus Theoretical Limit (orange)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_ConsPortfolioModel_5_3.png" src="../_images/example_notebooks_ConsPortfolioModel_5_3.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now simulate this consumer type</span>
<span class="n">MyType</span><span class="o">.</span><span class="n">track_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;cNrm&quot;</span><span class="p">,</span> <span class="s2">&quot;Share&quot;</span><span class="p">,</span> <span class="s2">&quot;aNrm&quot;</span><span class="p">,</span> <span class="s2">&quot;t_age&quot;</span><span class="p">]</span>
<span class="n">MyType</span><span class="o">.</span><span class="n">T_sim</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">MyType</span><span class="o">.</span><span class="n">initialize_sim</span><span class="p">()</span>
<span class="n">MyType</span><span class="o">.</span><span class="n">simulate</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;cNrm&#39;: array([[0.90817813, 1.03234821, 0.93895877, ..., 0.97818197, 0.84936023,
         1.12020242],
        [0.94387464, 1.04618213, 0.96697859, ..., 1.03897301, 0.91091442,
         1.03919036],
        [1.03073799, 1.13701208, 1.0316563 , ..., 1.09427432, 1.00371896,
         0.99544467],
        ...,
        [1.32162527, 1.21076537, 1.01074883, ..., 1.0813753 , 1.10376194,
         1.12370596],
        [1.27953116, 1.24979895, 1.0246158 , ..., 1.07214199, 1.10681034,
         1.12995356],
        [1.34144268, 1.22379512, 1.01448791, ..., 1.09167141, 1.15069166,
         1.17400165]]),
 &#39;Share&#39;: array([[1., 1., 1., ..., 1., 1., 1.],
        [1., 1., 1., ..., 1., 1., 1.],
        [1., 1., 1., ..., 1., 1., 1.],
        ...,
        [1., 1., 1., ..., 1., 1., 1.],
        [1., 1., 1., ..., 1., 1., 1.],
        [1., 1., 1., ..., 1., 1., 1.]]),
 &#39;aNrm&#39;: array([[0.45105775, 1.02451044, 0.55260976, ..., 0.71761922, 0.30438465,
         1.69655849],
        [0.57105533, 1.11746465, 0.66575831, ..., 1.06830346, 0.45948133,
         1.06977269],
        [1.01397913, 1.84344229, 1.0199851 , ..., 1.47978766, 0.85064373,
         0.80527169],
        ...,
        [3.68671257, 2.53609018, 0.89092116, ..., 1.37716071, 1.55764169,
         1.7267872 ],
        [3.23654313, 2.92796945, 0.97503629, ..., 1.30581208, 1.58295725,
         1.78118317],
        [3.90372017, 2.66508862, 0.91286243, ..., 1.45882001, 1.96645509,
         2.18204542]]),
 &#39;t_age&#39;: array([[ 1.,  1.,  1., ...,  1.,  1.,  1.],
        [ 2.,  2.,  2., ...,  2.,  2.,  2.],
        [ 3.,  3.,  3., ...,  3.,  3.,  3.],
        ...,
        [54., 66., 23., ..., 20., 33., 89.],
        [55., 67., 24., ..., 21., 34., 90.],
        [56., 68., 25., ..., 22., 35., 91.]])}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;For derivation of the numerical limiting portfolio share&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;as market resources approach infinity, see&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;http://www.econ2.jhu.edu/people/ccarroll/public/lecturenotes/AssetPricing/Portfolio-CRRA/&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>




For derivation of the numerical limiting portfolio share
as market resources approach infinity, see
http://www.econ2.jhu.edu/people/ccarroll/public/lecturenotes/AssetPricing/Portfolio-CRRA/
</pre></div></div>
</div>
</section>
<section id="2.-Discrete-portfolio-choice">
<h2>2. Discrete portfolio choice<a class="headerlink" href="#2.-Discrete-portfolio-choice" title="Permalink to this heading">#</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make another example type, but this one optimizes risky portfolio share only</span>
<span class="c1"># on the discrete grid of values implicitly chosen by RiskyCount, using explicit</span>
<span class="c1"># value maximization.</span>
<span class="n">DiscConsPortfolioDict</span> <span class="o">=</span> <span class="n">ConsPortfolioDict</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">DiscConsPortfolioDict</span><span class="p">[</span><span class="s2">&quot;DiscreteShareBool&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="c1"># Have to actually construct value function for this to work</span>
<span class="n">DiscConsPortfolioDict</span><span class="p">[</span><span class="s2">&quot;vFuncBool&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the discrete type using the dictionary, then change relevant attributes</span>
<span class="n">DiscreteType</span> <span class="o">=</span> <span class="n">PortfolioConsumerType</span><span class="p">(</span><span class="o">**</span><span class="n">DiscConsPortfolioDict</span><span class="p">)</span>
<span class="n">DiscreteType</span><span class="o">.</span><span class="n">cycles</span> <span class="o">=</span> <span class="mi">0</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Now solving a discrete choice portfolio problem; this might take a minute...&quot;</span><span class="p">)</span>

<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">DiscreteType</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">DiscreteType</span><span class="o">.</span><span class="n">cFunc</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">DiscreteType</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">cFuncAdj</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DiscreteType</span><span class="o">.</span><span class="n">T_cycle</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">DiscreteType</span><span class="o">.</span><span class="n">ShareFunc</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">DiscreteType</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">ShareFuncAdj</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DiscreteType</span><span class="o">.</span><span class="n">T_cycle</span><span class="p">)</span>
<span class="p">]</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Solving an infinite horizon discrete portfolio choice problem took &quot;</span>
    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>
    <span class="o">+</span> <span class="s2">&quot; seconds.&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Now solving a discrete choice portfolio problem; this might take a minute...
Solving an infinite horizon discrete portfolio choice problem took 10.660706520080566 seconds.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the consumption and risky-share functions</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Consumption function over market resources:&quot;</span><span class="p">)</span>
<span class="n">plot_funcs</span><span class="p">(</span><span class="n">DiscreteType</span><span class="o">.</span><span class="n">cFunc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Risky asset share as a function of market resources:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Optimal (blue) versus Theoretical Limit (orange)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Normalized Market Resources&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Portfolio Share&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="c1"># Since we are using a discretization of the lognormal distribution,</span>
<span class="c1"># the limit is numerically computed and slightly different from</span>
<span class="c1"># the analytical limit obtained by Merton and Samuelson for infinite wealth</span>
<span class="n">plot_funcs</span><span class="p">(</span>
    <span class="p">[</span><span class="n">DiscreteType</span><span class="o">.</span><span class="n">ShareFunc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">DiscreteType</span><span class="o">.</span><span class="n">ShareLimit</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">m</span><span class="p">)],</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">200.0</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Consumption function over market resources:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_ConsPortfolioModel_11_1.png" src="../_images/example_notebooks_ConsPortfolioModel_11_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Risky asset share as a function of market resources:
Optimal (blue) versus Theoretical Limit (orange)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_ConsPortfolioModel_11_3.png" src="../_images/example_notebooks_ConsPortfolioModel_11_3.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>




</pre></div></div>
</div>
</section>
<section id="3.-A-model-of-%22sticky%22-portfolio-choice">
<h2>3. A model of sticky portfolio choice<a class="headerlink" href="#3.-A-model-of-%22sticky%22-portfolio-choice" title="Permalink to this heading">#</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make another example type, but this one can only update their risky portfolio</span>
<span class="c1"># share in any particular period with 15% probability.</span>
<span class="n">StickyConsPortfolioDict</span> <span class="o">=</span> <span class="n">ConsPortfolioDict</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">StickyConsPortfolioDict</span><span class="p">[</span><span class="s2">&quot;AdjustPrb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.15</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make and solve a discrete portfolio choice consumer type</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s1">&#39;Now solving a portfolio choice problem with &quot;sticky&quot; portfolio shares; this might take a moment...&#39;</span>
<span class="p">)</span>
<span class="n">StickyType</span> <span class="o">=</span> <span class="n">PortfolioConsumerType</span><span class="p">(</span><span class="o">**</span><span class="n">StickyConsPortfolioDict</span><span class="p">)</span>
<span class="n">StickyType</span><span class="o">.</span><span class="n">cycles</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">StickyType</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">StickyType</span><span class="o">.</span><span class="n">cFuncAdj</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">StickyType</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">cFuncAdj</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">StickyType</span><span class="o">.</span><span class="n">T_cycle</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">StickyType</span><span class="o">.</span><span class="n">cFuncFxd</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">StickyType</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">cFuncFxd</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">StickyType</span><span class="o">.</span><span class="n">T_cycle</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">StickyType</span><span class="o">.</span><span class="n">ShareFunc</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">StickyType</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">ShareFuncAdj</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">StickyType</span><span class="o">.</span><span class="n">T_cycle</span><span class="p">)</span>
<span class="p">]</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Solving an infinite horizon sticky portfolio choice problem took &quot;</span>
    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>
    <span class="o">+</span> <span class="s2">&quot; seconds.&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Now solving a portfolio choice problem with &#34;sticky&#34; portfolio shares; this might take a moment...
Solving an infinite horizon sticky portfolio choice problem took 15.416635036468506 seconds.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the consumption and risky-share functions</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Consumption function over market resources when the agent can adjust his portfolio:&quot;</span>
<span class="p">)</span>
<span class="n">plot_funcs</span><span class="p">(</span><span class="n">StickyType</span><span class="o">.</span><span class="n">cFuncAdj</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Consumption function over market resources when the agent can adjust his portfolio:
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_ConsPortfolioModel_16_1.png" src="../_images/example_notebooks_ConsPortfolioModel_16_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Consumption function over market resources when the agent CAN&#39;T adjust, by current share:&quot;</span>
<span class="p">)</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">21</span><span class="p">):</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">StickyType</span><span class="o">.</span><span class="n">cFuncFxd</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">M</span><span class="p">,</span> <span class="n">s</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">M</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Consumption function over market resources when the agent CAN&#39;T adjust, by current share:
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_ConsPortfolioModel_17_1.png" src="../_images/example_notebooks_ConsPortfolioModel_17_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Risky asset share function over market resources (when possible to adjust):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Optimal (blue) versus Theoretical Limit (orange)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Normalized Market Resources&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Portfolio Share&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">plot_funcs</span><span class="p">(</span>
    <span class="p">[</span><span class="n">StickyType</span><span class="o">.</span><span class="n">ShareFunc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">StickyType</span><span class="o">.</span><span class="n">ShareLimit</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">m</span><span class="p">)],</span>
    <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">200.0</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Risky asset share function over market resources (when possible to adjust):
Optimal (blue) versus Theoretical Limit (orange)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_ConsPortfolioModel_18_1.png" src="../_images/example_notebooks_ConsPortfolioModel_18_1.png" />
</div>
</div>
<p>Notice the wiggle in the blue line. This reflects the fact that the maximum grid point for which the solution is calculated is <span class="math notranslate nohighlight">\(a=100\)</span> and the (incorrect) assumption built into the model that the portfolio share asymptotes to the frictionless analytical case. An alternative (not yet implemented) would be to calculate the implicit limit defined by the rate of geometric decay among the last grid points and assume that this is the limit.</p>
<p>The difference between the two is likely due to the agents inability to adjust their portfolio.</p>
</section>
<section id="4.-Life-cycle-model-of-portfolio-choice">
<h2>4. Life-cycle model of portfolio choice<a class="headerlink" href="#4.-Life-cycle-model-of-portfolio-choice" title="Permalink to this heading">#</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">LC_ConsPortfolioDict</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">ConsPortfolioDict</span><span class="p">)</span>
<span class="n">LC_ConsPortfolioDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">time_params</span><span class="p">)</span>
<span class="n">LC_ConsPortfolioDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dist_params</span><span class="p">)</span>
<span class="c1"># Note the income specification overrides the pLvlInitMean from the SCF.</span>
<span class="n">LC_ConsPortfolioDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">income_params</span><span class="p">)</span>
<span class="n">LC_ConsPortfolioDict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;LivPrb&quot;</span><span class="p">:</span> <span class="n">liv_prb</span><span class="p">})</span>

<span class="n">LC_ConsPortfolioDict</span><span class="p">[</span><span class="s2">&quot;RiskyAvg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.08</span><span class="p">]</span> <span class="o">*</span> <span class="n">init_lifecycle</span><span class="p">[</span><span class="s2">&quot;T_cycle&quot;</span><span class="p">]</span>
<span class="n">LC_ConsPortfolioDict</span><span class="p">[</span><span class="s2">&quot;RiskyStd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">,</span> <span class="n">init_lifecycle</span><span class="p">[</span><span class="s2">&quot;T_cycle&quot;</span><span class="p">])</span>
<span class="p">)</span>
<span class="n">LC_ConsPortfolioDict</span><span class="p">[</span><span class="s2">&quot;RiskyAvgTrue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.08</span>
<span class="n">LC_ConsPortfolioDict</span><span class="p">[</span><span class="s2">&quot;RiskyStdTrue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.20</span>
<span class="n">AgeVaryingRiskPercType</span> <span class="o">=</span> <span class="n">PortfolioConsumerType</span><span class="p">(</span><span class="o">**</span><span class="n">LC_ConsPortfolioDict</span><span class="p">)</span>
<span class="n">AgeVaryingRiskPercType</span><span class="o">.</span><span class="n">cycles</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solve the agent type with age-varying risk perceptions</span>
<span class="c1"># print(&#39;Now solving a portfolio choice problem with age-varying risk perceptions...&#39;)</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">AgeVaryingRiskPercType</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="n">AgeVaryingRiskPercType</span><span class="o">.</span><span class="n">cFunc</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">AgeVaryingRiskPercType</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">cFuncAdj</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">AgeVaryingRiskPercType</span><span class="o">.</span><span class="n">T_cycle</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">AgeVaryingRiskPercType</span><span class="o">.</span><span class="n">ShareFunc</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">AgeVaryingRiskPercType</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">ShareFuncAdj</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">AgeVaryingRiskPercType</span><span class="o">.</span><span class="n">T_cycle</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Solving a &quot;</span>
    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">AgeVaryingRiskPercType</span><span class="o">.</span><span class="n">T_cycle</span><span class="p">)</span>
    <span class="o">+</span> <span class="s2">&quot; period portfolio choice problem with age-varying risk perceptions took &quot;</span>
    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>
    <span class="o">+</span> <span class="s2">&quot; seconds.&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Solving a 65 period portfolio choice problem with age-varying risk perceptions took 1.390275478363037 seconds.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the consumption and risky-share functions</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Consumption function over market resources in each lifecycle period:&quot;</span><span class="p">)</span>
<span class="n">plot_funcs</span><span class="p">(</span><span class="n">AgeVaryingRiskPercType</span><span class="o">.</span><span class="n">cFunc</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Risky asset share function over market resources in each lifecycle period:&quot;</span><span class="p">)</span>
<span class="n">plot_funcs</span><span class="p">(</span><span class="n">AgeVaryingRiskPercType</span><span class="o">.</span><span class="n">ShareFunc</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Consumption function over market resources in each lifecycle period:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_ConsPortfolioModel_23_1.png" src="../_images/example_notebooks_ConsPortfolioModel_23_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Risky asset share function over market resources in each lifecycle period:
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_ConsPortfolioModel_23_3.png" src="../_images/example_notebooks_ConsPortfolioModel_23_3.png" />
</div>
</div>
</section>
<section id="5.-Portfolio-choice-with-Merton-Samuelson-limiting-shares">
<h2>5. Portfolio choice with Merton-Samuelson limiting shares<a class="headerlink" href="#5.-Portfolio-choice-with-Merton-Samuelson-limiting-shares" title="Permalink to this heading">#</a></h2>
<p>The code below tests the mathematical limits of the model and features the definition of a Merton-Samuelson type consumer.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a grid of market resources for the plots</span>
<span class="n">mMin</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Minimum ratio of assets to income to plot</span>
<span class="n">mMax</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="mf">1e2</span>  <span class="c1"># Maximum ratio of assets to income to plot</span>
<span class="n">mPts</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># Number of points to plot</span>
<span class="n">plot_point_max</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">aXtraMax</span> <span class="o">=</span> <span class="n">plot_point_max</span> <span class="o">*</span> <span class="mi">10</span>  <span class="c1"># Maximum asset level</span>

<span class="n">eevalgrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mMax</span><span class="p">,</span> <span class="n">mPts</span><span class="p">)</span>  <span class="c1"># range of values of assets for the plot</span>

<span class="c1"># Number of points that will be used to approximate the risky distribution</span>
<span class="n">risky_count_grid</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">200</span><span class="p">]</span>
<span class="c1"># Plot by ages (time periods) at which to plot. We will use the default life-cycle calibration.</span>
<span class="n">ages</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Creating the dictionary for the Merton-Samuelson consumer type</span>
<span class="n">MertonPortfolioDict</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">ConsPortfolioDict</span><span class="p">)</span>
<span class="n">MertonPortfolioDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">time_params</span><span class="p">)</span>
<span class="n">MertonPortfolioDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dist_params</span><span class="p">)</span>
<span class="c1"># Note the income specification overrides the pLvlInitMean from the SCF.</span>
<span class="n">MertonPortfolioDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">income_params</span><span class="p">)</span>
<span class="n">MertonPortfolioDict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;LivPrb&quot;</span><span class="p">:</span> <span class="n">liv_prb</span><span class="p">})</span>

<span class="n">MertonPortfolioDict</span><span class="p">[</span><span class="s2">&quot;RiskyAvgTrue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.08</span>
<span class="n">MertonPortfolioDict</span><span class="p">[</span><span class="s2">&quot;RiskyStdTrue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.20</span>


<span class="c1"># Create a function to compute the Merton-Samuelson limiting portfolio share.</span>
<span class="k">def</span> <span class="nf">RiskyShareMertSamLogNormal</span><span class="p">(</span><span class="n">RiskPrem</span><span class="p">,</span> <span class="n">CRRA</span><span class="p">,</span> <span class="n">RiskyVar</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">RiskPrem</span> <span class="o">/</span> <span class="p">(</span><span class="n">CRRA</span> <span class="o">*</span> <span class="n">RiskyVar</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">rcount</span> <span class="ow">in</span> <span class="n">risky_count_grid</span><span class="p">:</span>
    <span class="c1"># Create a new dictionary and replace the number of points that</span>
    <span class="c1"># approximate the risky return distribution</span>

    <span class="c1"># Create new dictionary copying the default.</span>
    <span class="n">MertonPortfolioDict</span><span class="p">[</span><span class="s2">&quot;RiskyCount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rcount</span>

    <span class="c1"># Create and solve agent</span>
    <span class="n">agent</span> <span class="o">=</span> <span class="n">PortfolioConsumerType</span><span class="p">(</span><span class="o">**</span><span class="n">MertonPortfolioDict</span><span class="p">)</span>
    <span class="n">agent</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>

    <span class="c1"># Compute the analytical Merton-Samuelson limiting portfolio share</span>
    <span class="n">RiskyVar</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">RiskyStd</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">RiskPrem</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">RiskyAvg</span> <span class="o">-</span> <span class="n">agent</span><span class="o">.</span><span class="n">Rfree</span>
    <span class="n">MS_limit</span> <span class="o">=</span> <span class="n">RiskyShareMertSamLogNormal</span><span class="p">(</span><span class="n">RiskPrem</span><span class="p">,</span> <span class="n">agent</span><span class="o">.</span><span class="n">CRRA</span><span class="p">,</span> <span class="n">RiskyVar</span><span class="p">)</span>

    <span class="c1"># Now compute the limiting share numerically, using the approximated</span>
    <span class="c1"># distribution</span>
    <span class="n">agent</span><span class="o">.</span><span class="n">update_ShareLimit</span><span class="p">()</span>
    <span class="n">NU_limit</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">ShareLimit</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ages</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">eevalgrid</span><span class="p">,</span> <span class="n">agent</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">ShareFuncAdj</span><span class="p">(</span><span class="n">eevalgrid</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;t = </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span>
        <span class="n">NU_limit</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Exact limit as $m</span><span class="se">\\</span><span class="s2">rightarrow </span><span class="se">\\</span><span class="s2">infty$.&quot;</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span>
        <span class="n">MS_limit</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;M&amp;S Limit without returns discretization.&quot;</span>
    <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">eevalgrid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">eevalgrid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
        <span class="s2">&quot;Risky Portfolio Share by Age</span><span class="se">\n</span><span class="s2"> Risky distribution with </span><span class="si">{points}</span><span class="s2"> equiprobable points&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">points</span><span class="o">=</span><span class="n">rcount</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Wealth (m)&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_ConsPortfolioModel_27_0.png" src="../_images/example_notebooks_ConsPortfolioModel_27_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_ConsPortfolioModel_27_1.png" src="../_images/example_notebooks_ConsPortfolioModel_27_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_ConsPortfolioModel_27_2.png" src="../_images/example_notebooks_ConsPortfolioModel_27_2.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="KinkedRconsumerType.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">KinkedRconsumerType: Consumption-saving model with idiosyncratic income shocks and different interest rates on borrowing and saving</p>
      </div>
    </a>
    <a class="right-next"
       href="GenIncProcessModel.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Permanent versus Persistent Income Shocks</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#1.-The-baseline-model-of-optimal-portfolio-choice">1. The baseline model of optimal portfolio choice</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#2.-Discrete-portfolio-choice">2. Discrete portfolio choice</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#3.-A-model-of-%22sticky%22-portfolio-choice">3. A model of sticky portfolio choice</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#4.-Life-cycle-model-of-portfolio-choice">4. Life-cycle model of portfolio choice</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#5.-Portfolio-choice-with-Merton-Samuelson-limiting-shares">5. Portfolio choice with Merton-Samuelson limiting shares</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="../_sources/example_notebooks/ConsPortfolioModel.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
       Copyright 2020, Econ-ARK team.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.0.1.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>